{"ast":null,"code":"import{useState,useEffect}from'react';const KEY=\"626f89cc\";export function useMovies(query){const[movies,setMovies]=useState([]);const[isLoading,setIsLoading]=useState(false);const[error,setError]=useState(\"\");useEffect(function(){// callback?.();\nconst controller=new AbortController();async function fetchMovies(){//fetching data\ntry{setIsLoading(true);setError('');const res=await fetch(\"http://www.omdbapi.com/?apikey=\".concat(KEY,\"&s=\").concat(query),{single:controller.single});if(!res.ok)throw new Error(\"Something went wrong with fetching data\");const data=await res.json();if(data.Response==='False')throw new Error(\"Movie not found\");setMovies(data.Search);setError(\"\");}catch(err){if(err.name!==\"AbortError\"){console.error(err.message);setError(err.message);}}finally{setIsLoading(false);}}if(query.length<3){setMovies([]);setError('');//如果是这样的情况,直接返回,不调用fetch函数\nreturn;}fetchMovies();return function(){// 当再次键入时,停止当前的fetch\ncontroller.abort();};},[query]);return{movies,isLoading,error};}","map":{"version":3,"names":["useState","useEffect","KEY","useMovies","query","movies","setMovies","isLoading","setIsLoading","error","setError","controller","AbortController","fetchMovies","res","fetch","concat","single","ok","Error","data","json","Response","Search","err","name","console","message","length","abort"],"sources":["/Volumes/countstarss/Skill Stack/React/ReactLearn/07-usePopcorn/src/useMovies.js"],"sourcesContent":["import {useState,useEffect} from 'react'\n\n\nconst KEY = `626f89cc`;\nexport  function useMovies(query) {\n\n    const [movies, setMovies] = useState([]);\n    const [isLoading, setIsLoading] = useState(false);\n    const [error, setError] = useState(\"\");\n\n\n    useEffect(function () {\n        // callback?.();\n\n        const controller = new AbortController();\n\n        async function fetchMovies() {\n            //fetching data\n            try {\n                setIsLoading(true);\n                setError('');\n                const res = await fetch(`http://www.omdbapi.com/?apikey=${KEY}&s=${query}`, { single: controller.single })\n\n                if (!res.ok) throw new Error(\"Something went wrong with fetching data\")\n\n                const data = await res.json()\n                if (data.Response === 'False') throw new Error(\"Movie not found\");\n\n                setMovies(data.Search)\n                setError(\"\");\n            } catch (err) {\n\n                if (err.name !== \"AbortError\") {\n                    console.error(err.message);\n                    setError(err.message);\n                }\n            } finally {\n                setIsLoading(false);\n            }\n        }\n        if (query.length < 3) {\n            setMovies([]);\n            setError('');\n            //如果是这样的情况,直接返回,不调用fetch函数\n            return;\n        }\n        fetchMovies();\n\n        return function () {\n            // 当再次键入时,停止当前的fetch\n            controller.abort();\n        }\n    }, [query]);\n    return {movies,isLoading,error}\n}\n"],"mappings":"AAAA,OAAQA,QAAQ,CAACC,SAAS,KAAO,OAAO,CAGxC,KAAM,CAAAC,GAAG,WAAa,CACtB,MAAQ,SAAS,CAAAC,SAASA,CAACC,KAAK,CAAE,CAE9B,KAAM,CAACC,MAAM,CAAEC,SAAS,CAAC,CAAGN,QAAQ,CAAC,EAAE,CAAC,CACxC,KAAM,CAACO,SAAS,CAAEC,YAAY,CAAC,CAAGR,QAAQ,CAAC,KAAK,CAAC,CACjD,KAAM,CAACS,KAAK,CAAEC,QAAQ,CAAC,CAAGV,QAAQ,CAAC,EAAE,CAAC,CAGtCC,SAAS,CAAC,UAAY,CAClB;AAEA,KAAM,CAAAU,UAAU,CAAG,GAAI,CAAAC,eAAe,CAAC,CAAC,CAExC,cAAe,CAAAC,WAAWA,CAAA,CAAG,CACzB;AACA,GAAI,CACAL,YAAY,CAAC,IAAI,CAAC,CAClBE,QAAQ,CAAC,EAAE,CAAC,CACZ,KAAM,CAAAI,GAAG,CAAG,KAAM,CAAAC,KAAK,mCAAAC,MAAA,CAAmCd,GAAG,QAAAc,MAAA,CAAMZ,KAAK,EAAI,CAAEa,MAAM,CAAEN,UAAU,CAACM,MAAO,CAAC,CAAC,CAE1G,GAAI,CAACH,GAAG,CAACI,EAAE,CAAE,KAAM,IAAI,CAAAC,KAAK,CAAC,yCAAyC,CAAC,CAEvE,KAAM,CAAAC,IAAI,CAAG,KAAM,CAAAN,GAAG,CAACO,IAAI,CAAC,CAAC,CAC7B,GAAID,IAAI,CAACE,QAAQ,GAAK,OAAO,CAAE,KAAM,IAAI,CAAAH,KAAK,CAAC,iBAAiB,CAAC,CAEjEb,SAAS,CAACc,IAAI,CAACG,MAAM,CAAC,CACtBb,QAAQ,CAAC,EAAE,CAAC,CAChB,CAAE,MAAOc,GAAG,CAAE,CAEV,GAAIA,GAAG,CAACC,IAAI,GAAK,YAAY,CAAE,CAC3BC,OAAO,CAACjB,KAAK,CAACe,GAAG,CAACG,OAAO,CAAC,CAC1BjB,QAAQ,CAACc,GAAG,CAACG,OAAO,CAAC,CACzB,CACJ,CAAC,OAAS,CACNnB,YAAY,CAAC,KAAK,CAAC,CACvB,CACJ,CACA,GAAIJ,KAAK,CAACwB,MAAM,CAAG,CAAC,CAAE,CAClBtB,SAAS,CAAC,EAAE,CAAC,CACbI,QAAQ,CAAC,EAAE,CAAC,CACZ;AACA,OACJ,CACAG,WAAW,CAAC,CAAC,CAEb,MAAO,WAAY,CACf;AACAF,UAAU,CAACkB,KAAK,CAAC,CAAC,CACtB,CAAC,CACL,CAAC,CAAE,CAACzB,KAAK,CAAC,CAAC,CACX,MAAO,CAACC,MAAM,CAACE,SAAS,CAACE,KAAK,CAAC,CACnC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}